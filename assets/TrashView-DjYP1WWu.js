import{_ as M,e as u,g as N,R as U,B as E,b as l,a as t,i as b,d as C,F as k,p as g,o as n,y as F,t as d,l as m,S as L,U as z}from"./index-BUkxEhik.js";import{g as O,i as W,c as q,f as T,a as D,r as G,p as H,j as J}from"./projectRepository-Bp8vvTf4.js";import{C as P}from"./ConfirmDialog-RS1OHfPS.js";const K={class:"trash-view"},Q={class:"trash-view__header"},X={key:0,class:"trash-view__loading"},Y={key:1,class:"trash-view__empty"},Z={key:2,class:"trash-view__list"},tt={class:"trash-project__header"},et={class:"trash-project__info"},st={class:"trash-project__name"},at={key:0,class:"trash-project__deleted-badge"},ot={class:"trash-project__actions"},lt={class:"trash-project__stats"},nt={class:"trash-project__time"},rt={class:"trash-project__cost"},ct={key:0,class:"trash-project__btns"},it=["onClick"],dt=["onClick"],_t={class:"trash-project__tasks"},ut={class:"trash-task__name"},ht={class:"trash-task__right"},pt={class:"trash-task__meta"},vt=["onClick"],mt=["onClick"],jt={__name:"TrashView",setup(yt){const j=u(!0),h=u([]),p=u(!1),y=u(!1),c=u({type:null,id:null});N(async()=>{await _()});async function _(){j.value=!0;try{const a=await O(),o=await W(),s=[...a,...o],r=new Map(s.map(e=>[e.id,e])),f=await U(),R=await Promise.all(f.map(async e=>{const v=await E(e.id),w=r.get(e.projectId),$=w?w.hourlyRate:0;return{...e,totalSeconds:v,totalCost:q(v,$),project:w}})),i={};R.forEach(e=>{e.project&&(i[e.projectId]||(i[e.projectId]={project:e.project,tasks:[],totalSeconds:0,totalCost:0}),i[e.projectId].tasks.push(e),i[e.projectId].totalSeconds+=e.totalSeconds,i[e.projectId].totalCost+=e.totalCost)}),h.value=Object.values(i).sort((e,v)=>v.totalCost-e.totalCost)}catch(a){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:",a)}finally{j.value=!1}}async function V(a){try{await L(a),await _()}catch(o){console.error("–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:",o)}}async function S(a){try{await G(a),await _()}catch(o){console.error("–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:",o)}}function A(a){c.value={type:"task",id:a},p.value=!0}function I(a){c.value={type:"project",id:a},p.value=!0}async function x(){try{c.value.type==="task"?await z(c.value.id):c.value.type==="project"&&await H(c.value.id),await _()}catch(a){console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:",a)}finally{c.value={type:null,id:null}}}async function B(){try{await J(),await _()}catch(a){console.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:",a)}}return(a,o)=>(n(),l("div",K,[t("header",Q,[o[3]||(o[3]=t("div",null,[t("h1",{class:"trash-view__title"},"–ö–æ—Ä–∑–∏–Ω–∞"),t("p",{class:"trash-view__subtitle"}," –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ –ø—Ä–æ–µ–∫—Ç—ã. –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞. ")],-1)),h.value.length>0?(n(),l("button",{key:0,class:"trash-view__clear-btn",onClick:o[0]||(o[0]=s=>y.value=!0)}," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É ")):C("",!0)]),j.value?(n(),l("div",X," –ó–∞–≥—Ä—É–∑–∫–∞... ")):h.value.length===0?(n(),l("div",Y,[...o[4]||(o[4]=[t("div",{class:"trash-view__empty-icon"},"‚ú®",-1),t("h3",null,"–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞",-1),t("p",null,"–ù–µ—Ç —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤",-1)])])):(n(),l("div",Z,[(n(!0),l(k,null,g(h.value,s=>(n(),l("div",{key:s.project.id,class:"trash-project"},[t("div",tt,[t("div",et,[t("div",{class:"trash-project__color",style:F({backgroundColor:s.project.color})},null,4),t("div",null,[t("h2",st,d(s.project.name),1),s.project.deletedAt?(n(),l("span",at," –ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª—ë–Ω ")):C("",!0)])]),t("div",ot,[t("div",lt,[t("span",nt,d(m(T)(s.totalSeconds)),1),t("span",rt,d(m(D)(s.totalCost)),1)]),s.project.deletedAt?(n(),l("div",ct,[t("button",{class:"trash-btn trash-btn--restore",onClick:r=>S(s.project.id),title:"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç"}," ‚Ü© –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ",8,it),t("button",{class:"trash-btn trash-btn--delete",onClick:r=>I(s.project.id),title:"–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞"}," ‚úï ",8,dt)])):C("",!0)])]),t("div",_t,[(n(!0),l(k,null,g(s.tasks,r=>(n(),l("div",{key:r.id,class:"trash-task"},[t("div",ut,d(r.name),1),t("div",ht,[t("div",pt,[t("span",null,d(m(T)(r.totalSeconds)),1),t("span",null,d(m(D)(r.totalCost)),1)]),t("button",{class:"trash-btn trash-btn--icon",onClick:f=>V(r.id),title:"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"}," ‚Ü© ",8,vt),t("button",{class:"trash-btn trash-btn--icon trash-btn--delete",onClick:f=>A(r.id),title:"–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞"}," ‚úï ",8,mt)])]))),128))])]))),128))])),b(P,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=s=>p.value=s),title:"–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞?",message:"–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ.","confirm-text":"–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞",onConfirm:x},null,8,["modelValue"]),b(P,{modelValue:y.value,"onUpdate:modelValue":o[2]||(o[2]=s=>y.value=s),title:"–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?",message:"–í—Å–µ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –ù–ê–í–°–ï–ì–î–ê. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.","confirm-text":"–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë",onConfirm:B},null,8,["modelValue"])]))}},bt=M(jt,[["__scopeId","data-v-ad6e13bb"]]);export{bt as default};

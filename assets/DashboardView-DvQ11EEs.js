import{T as I}from"./Timer-ZiVtQpXt.js";import{B as D}from"./BaseCard-DVAj1GNh.js";import{_ as y,c as S,o as r,w as u,a as t,b as l,d as V,r as A,t as T,e as b,f as d,g as x,h as M,i,j as E,k as N,u as H,l as h,m as C,n as q,F,p as L}from"./index-BUkxEhik.js";import{f as R,c as z,a as G,g as J}from"./projectRepository-Bp8vvTf4.js";import{u as K,P as O}from"./useProjects-BwgIbSz4.js";const Q={class:"stat-card"},U={key:0,class:"stat-card__icon"},W={class:"stat-card__content"},X={class:"stat-card__label"},Y={class:"stat-card__value"},Z={__name:"StatCard",props:{label:{type:String,required:!0},value:{type:String,required:!0}},setup(_){return(s,c)=>(r(),S(D,null,{default:u(()=>[t("div",Q,[s.$slots.icon?(r(),l("div",U,[A(s.$slots,"icon",{},void 0,!0)])):V("",!0),t("div",W,[t("span",X,T(_.label),1),t("span",Y,T(_.value),1)])])]),_:3}))}},w=y(Z,[["__scopeId","data-v-562b35ff"]]),tt={class:"project-stats"},et={__name:"ProjectStats",props:{refreshTrigger:{type:Number,default:0}},setup(_){const s=_,c=b([]),m=b([]),p=b([]),f=d(()=>c.value.length),g=d(()=>p.value.reduce((o,a)=>o+(a.duration||0),0)),j=d(()=>R(g.value)),k=d(()=>{let o=0;for(const a of c.value){const $=m.value.filter(n=>n.projectId===a.id).map(n=>n.id),B=p.value.filter(n=>$.includes(n.taskId)).reduce((n,P)=>n+(P.duration||0),0);o+=z(B,a.hourlyRate)}return o}),e=d(()=>G(k.value));async function v(){try{c.value=await J(),m.value=await E(),p.value=await N()}catch(o){console.error("Ошибка загрузки статистики:",o)}}return x(()=>{v()}),M(()=>s.refreshTrigger,()=>{v()}),(o,a)=>(r(),l("div",tt,[i(w,{label:"Проектов",value:String(f.value)},{icon:u(()=>[...a[0]||(a[0]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})],-1)])]),_:1},8,["value"]),i(w,{label:"Общее время",value:j.value},{icon:u(()=>[...a[1]||(a[1]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12,6 12,12 16,14"})],-1)])]),_:1},8,["value"]),i(w,{label:"Общий доход",value:e.value},{icon:u(()=>[...a[2]||(a[2]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),t("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})],-1)])]),_:1},8,["value"])]))}},st=y(et,[["__scopeId","data-v-5cae03a8"]]),at={class:"dashboard"},ot={class:"dashboard__section"},rt={class:"dashboard__section"},nt={class:"dashboard__section"},lt={class:"dashboard__section-header"},it={key:0,class:"dashboard__loading"},ct={key:1,class:"dashboard__empty"},dt={key:2,class:"dashboard__projects"},ut={__name:"DashboardView",setup(_){const s=H(),{projects:c,isLoading:m,loadProjects:p}=K(),f=b(0),g=d(()=>[...c.value].sort((k,e)=>new Date(e.createdAt)-new Date(k.createdAt)).slice(0,3));x(async()=>{await s.checkActiveTimer(),await p()});async function j(){await s.stop(),f.value++}return(k,e)=>{const v=q("router-link");return r(),l("div",at,[e[5]||(e[5]=t("header",{class:"dashboard__header"},[t("h1",{class:"dashboard__title"},"Дашборд")],-1)),t("section",ot,[i(I,{"is-running":h(s).isRunning.value,"active-task":h(s).activeTask.value,"elapsed-seconds":h(s).elapsedSeconds.value,"is-paused":h(s).isPaused.value,onStop:j},null,8,["is-running","active-task","elapsed-seconds","is-paused"])]),t("section",rt,[e[0]||(e[0]=t("h2",{class:"dashboard__subtitle"},"Статистика",-1)),i(st,{"refresh-trigger":f.value},null,8,["refresh-trigger"])]),t("section",nt,[t("div",lt,[e[2]||(e[2]=t("h2",{class:"dashboard__subtitle"},"Проекты",-1)),i(v,{to:"/projects",class:"dashboard__link"},{default:u(()=>[...e[1]||(e[1]=[C(" Все проекты → ",-1)])]),_:1})]),h(m)?(r(),l("div",it," Загрузка... ")):g.value.length===0?(r(),l("div",ct,[e[4]||(e[4]=t("p",null,"У вас пока нет проектов",-1)),i(v,{to:"/projects",class:"dashboard__link"},{default:u(()=>[...e[3]||(e[3]=[C(" Создать первый проект ",-1)])]),_:1})])):(r(),l("div",dt,[(r(!0),l(F,null,L(g.value,o=>(r(),S(O,{key:o.id,project:o},null,8,["project"]))),128))]))])])}}},kt=y(ut,[["__scopeId","data-v-81afc7c9"]]);export{kt as default};

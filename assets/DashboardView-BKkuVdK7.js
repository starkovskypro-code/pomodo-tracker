import{T as P}from"./Timer-DwU7MS5A.js";import{B as D}from"./BaseCard-Bnuw-Bye.js";import{_ as y,c as S,o as r,w as u,a as t,b as l,d as V,r as A,t as T,e as b,f as d,g as x,h as M,i,j as E,k as N,u as H,l as k,m as C,n as q,F,p as L}from"./index-BNaTmjPP.js";import{f as R,c as z,a as G,g as J}from"./projectRepository-CTpxSQ9r.js";import{u as K,P as O}from"./useProjects-y7MtsXPX.js";const Q={class:"stat-card"},U={key:0,class:"stat-card__icon"},W={class:"stat-card__content"},X={class:"stat-card__label"},Y={class:"stat-card__value"},Z={__name:"StatCard",props:{label:{type:String,required:!0},value:{type:String,required:!0}},setup(_){return(a,c)=>(r(),S(D,null,{default:u(()=>[t("div",Q,[a.$slots.icon?(r(),l("div",U,[A(a.$slots,"icon",{},void 0,!0)])):V("",!0),t("div",W,[t("span",X,T(_.label),1),t("span",Y,T(_.value),1)])])]),_:3}))}},w=y(Z,[["__scopeId","data-v-562b35ff"]]),tt={class:"project-stats"},et={__name:"ProjectStats",props:{refreshTrigger:{type:Number,default:0}},setup(_){const a=_,c=b([]),h=b([]),p=b([]),m=d(()=>c.value.length),f=d(()=>p.value.reduce((o,s)=>o+(s.duration||0),0)),j=d(()=>R(f.value)),g=d(()=>{let o=0;for(const s of c.value){const $=h.value.filter(n=>n.projectId===s.id).map(n=>n.id),B=p.value.filter(n=>$.includes(n.taskId)).reduce((n,I)=>n+(I.duration||0),0);o+=z(B,s.hourlyRate)}return o}),e=d(()=>G(g.value));async function v(){try{c.value=await J(),h.value=await E(),p.value=await N()}catch(o){console.error("Ошибка загрузки статистики:",o)}}return x(()=>{v()}),M(()=>a.refreshTrigger,()=>{v()}),(o,s)=>(r(),l("div",tt,[i(w,{label:"Проектов",value:String(m.value)},{icon:u(()=>[...s[0]||(s[0]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})],-1)])]),_:1},8,["value"]),i(w,{label:"Общее время",value:j.value},{icon:u(()=>[...s[1]||(s[1]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12,6 12,12 16,14"})],-1)])]),_:1},8,["value"]),i(w,{label:"Общий доход",value:e.value},{icon:u(()=>[...s[2]||(s[2]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),t("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})],-1)])]),_:1},8,["value"])]))}},st=y(et,[["__scopeId","data-v-5cae03a8"]]),at={class:"dashboard"},ot={class:"dashboard__section"},rt={class:"dashboard__section"},nt={class:"dashboard__section"},lt={class:"dashboard__section-header"},it={key:0,class:"dashboard__loading"},ct={key:1,class:"dashboard__empty"},dt={key:2,class:"dashboard__projects"},ut={__name:"DashboardView",setup(_){const a=H(),{projects:c,isLoading:h,loadProjects:p}=K(),m=b(0),f=d(()=>[...c.value].sort((g,e)=>new Date(e.createdAt)-new Date(g.createdAt)).slice(0,3));x(async()=>{await a.checkActiveTimer(),await p()});async function j(){await a.stop(),m.value++}return(g,e)=>{const v=q("router-link");return r(),l("div",at,[e[5]||(e[5]=t("header",{class:"dashboard__header"},[t("h1",{class:"dashboard__title"},"Дашборд")],-1)),t("section",ot,[i(P,{"is-running":k(a).isRunning.value,"active-task":k(a).activeTask.value,"elapsed-seconds":k(a).elapsedSeconds.value,onStop:j},null,8,["is-running","active-task","elapsed-seconds"])]),t("section",rt,[e[0]||(e[0]=t("h2",{class:"dashboard__subtitle"},"Статистика",-1)),i(st,{"refresh-trigger":m.value},null,8,["refresh-trigger"])]),t("section",nt,[t("div",lt,[e[2]||(e[2]=t("h2",{class:"dashboard__subtitle"},"Проекты",-1)),i(v,{to:"/projects",class:"dashboard__link"},{default:u(()=>[...e[1]||(e[1]=[C(" Все проекты → ",-1)])]),_:1})]),k(h)?(r(),l("div",it," Загрузка... ")):f.value.length===0?(r(),l("div",ct,[e[4]||(e[4]=t("p",null,"У вас пока нет проектов",-1)),i(v,{to:"/projects",class:"dashboard__link"},{default:u(()=>[...e[3]||(e[3]=[C(" Создать первый проект ",-1)])]),_:1})])):(r(),l("div",dt,[(r(!0),l(F,null,L(f.value,o=>(r(),S(O,{key:o.id,project:o},null,8,["project"]))),128))]))])])}}},kt=y(ut,[["__scopeId","data-v-831209fb"]]);export{kt as default};

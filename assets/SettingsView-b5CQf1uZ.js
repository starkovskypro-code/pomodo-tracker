import{B as b}from"./BaseCard-Bnuw-Bye.js";import{B as w}from"./BaseButton-CDRO35Af.js";import{e as c,P as n,_ as j,b as k,a as s,i as p,d as y,w as _,l as g,m as f,t as x,o as v}from"./index-BNaTmjPP.js";function E(){const u=c(!1),i=c(!1),a=c(null);async function d(){u.value=!0,a.value=null;try{const l={exportedAt:new Date().toISOString(),version:1,projects:await n.projects.toArray(),tasks:await n.tasks.toArray(),timeEntries:await n.timeEntries.toArray()},o=JSON.stringify(l,null,2),e=new Blob([o],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t;const S=new Date().toISOString().split("T")[0];return r.download=`time-tracker-backup-${S}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t),!0}catch(l){return a.value="Ошибка при экспорте данных",console.error("Ошибка экспорта:",l),!1}finally{u.value=!1}}async function m(l){i.value=!0,a.value=null;try{const o=await l.text(),e=JSON.parse(o);if(!e.projects||!e.tasks||!e.timeEntries)throw new Error("Неверный формат файла");return await n.transaction("rw",[n.projects,n.tasks,n.timeEntries],async()=>{await n.projects.clear(),await n.tasks.clear(),await n.timeEntries.clear(),e.projects.length>0&&await n.projects.bulkAdd(e.projects),e.tasks.length>0&&await n.tasks.bulkAdd(e.tasks),e.timeEntries.length>0&&await n.timeEntries.bulkAdd(e.timeEntries)}),!0}catch(o){return a.value="Ошибка при импорте данных: "+o.message,console.error("Ошибка импорта:",o),!1}finally{i.value=!1}}return{isExporting:u,isImporting:i,error:a,exportData:d,importData:m}}const B={class:"settings"},N={class:"settings__section"},O={class:"settings__backup"},h={class:"settings__backup-item"},C={class:"settings__backup-item"},D={key:0,class:"settings__error"},I={key:1,class:"settings__success"},A={class:"settings__section"},J={__name:"SettingsView",setup(u){const i=E(),a=c(""),d=c(null);async function m(){a.value="",await i.exportData()&&(a.value="Данные успешно экспортированы!",setTimeout(()=>{a.value=""},3e3))}function l(){d.value?.click()}async function o(e){const t=e.target.files?.[0];if(!t)return;if(!confirm("Все текущие данные будут заменены данными из файла. Продолжить?")){e.target.value="";return}a.value="",await i.importData(t)&&(a.value="Данные успешно импортированы! Обновите страницу для применения.",setTimeout(()=>{window.location.reload()},1500)),e.target.value=""}return(e,t)=>(v(),k("div",B,[t[9]||(t[9]=s("header",{class:"settings__header"},[s("h1",{class:"settings__title"},"Настройки")],-1)),s("section",N,[t[5]||(t[5]=s("h2",{class:"settings__subtitle"},"Резервное копирование",-1)),t[6]||(t[6]=s("p",{class:"settings__description"}," Сохраните все данные в JSON-файл или восстановите из ранее сохранённой копии. ",-1)),p(b,null,{default:_(()=>[s("div",O,[s("div",h,[t[1]||(t[1]=s("div",{class:"settings__backup-info"},[s("h3",{class:"settings__backup-title"},"Экспорт данных"),s("p",{class:"settings__backup-text"}," Скачать все проекты, задачи и записи времени в JSON-файл ")],-1)),p(w,{variant:"secondary",onClick:m,loading:g(i).isExporting.value},{default:_(()=>[...t[0]||(t[0]=[f(" Скачать JSON ",-1)])]),_:1},8,["loading"])]),t[4]||(t[4]=s("div",{class:"settings__divider"},null,-1)),s("div",C,[t[3]||(t[3]=s("div",{class:"settings__backup-info"},[s("h3",{class:"settings__backup-title"},"Импорт данных"),s("p",{class:"settings__backup-text"},[f(" Загрузить данные из ранее сохранённого файла. "),s("strong",null,"Внимание: текущие данные будут заменены!")])],-1)),s("input",{ref_key:"fileInput",ref:d,type:"file",accept:".json",class:"settings__file-input",onChange:o},null,544),p(w,{variant:"secondary",onClick:l,loading:g(i).isImporting.value},{default:_(()=>[...t[2]||(t[2]=[f(" Загрузить JSON ",-1)])]),_:1},8,["loading"])])])]),_:1}),g(i).error.value?(v(),k("p",D,x(g(i).error.value),1)):y("",!0),a.value?(v(),k("p",I,x(a.value),1)):y("",!0)]),s("section",A,[t[8]||(t[8]=s("h2",{class:"settings__subtitle"},"О приложении",-1)),p(b,null,{default:_(()=>[...t[7]||(t[7]=[s("div",{class:"settings__about"},[s("p",null,[s("strong",null,"Time Tracker"),f(" — персональный сервис для отслеживания рабочего времени. ")]),s("p",null," Все данные хранятся локально в вашем браузере (IndexedDB). Ничего не отправляется на сервер. "),s("p",{class:"settings__version"},"Версия 1.0.0")],-1)])]),_:1})])]))}},R=j(J,[["__scopeId","data-v-8135afdc"]]);export{R as default};
